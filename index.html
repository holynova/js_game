<!DOCTYPE html>
<html lang="en">

<head>
  <title>js game</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    #canvas {
      /* width: 400px; */
      /* height: 300px; */
      border: 1px solid black;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width="800" height="600"></canvas>
  <script>
    var log = console.log.bind(console)
    var imageFromPath = function (path) {
      var image = new Image()
      image.src = path
      return image
    }
    var __main = function () {
      var Paddle = function () {
        var o = {
          x: 300,
          y: 550,
          speed: 10,
          image: imageFromPath('./paddle.png')
        }
        o.moveLeft = function () {
          o.x -= o.speed
          if (o.x < 0) {
            o.x = 0
          }
        }
        o.moveRight = function () {
          o.x += o.speed
          if (o.x + o.image.width > 800) {
            o.x = 800 - o.image.width
          }
        }
        o.collide = function (ball) {
          if (ball.x > o.x + o.image.width ||
            ball.x + ball.image.width < o.x ||
            ball.y > o.y + o.image.height ||
            ball.y + ball.image.height < o.y) {
            return false
          } else {
            return true
          }
        }
        return o
      }
      var Ball = function (x = 400, y = 500) {
        var o = {
          image: imageFromPath('./ball.png'),
          x: x,
          y: y,
          speedX: 5,
          speedY: -5,
          fired: false,
        }
        o.fire = function () {
          o.fired = true
        }
        o.move = function () {
          if (o.fired) {
            o.x += o.speedX
            o.y += o.speedY
            if (o.x < 0 || o.x + o.image.width > 800) {
              o.speedX *= -1
            }
            if (o.y < 0) {
              o.speedY *= -1
            }
          }
        }

        return o
      }
      var Game = function () {
        var o = {
          actions: {},
          keydowns: {},
          fps: 60,
        }
        o.canvas = document.querySelector('#canvas')
        o.context = canvas.getContext('2d')

        o.registerAction = function (key, callback) {
          o.actions[key] = callback
          o.keydowns[key] = false
        }
        o.drawImage = function (imageObj) {
          // log(imageObj)
          o.context.drawImage(imageObj.image, imageObj.x, imageObj.y)
        }
        document.addEventListener('keydown', function (event) {
          o.keydowns[event.key] = true
        }, false)

        document.addEventListener('keyup', function (event) {
          o.keydowns[event.key] = false
        }, false)
        o.draw = function () {
          log('Game.draw')
        }
        o.update = function () {
          log('Game.update')
        }
        setInterval(function () {
          var keys = Object.keys(o.actions)
          for (let i = 0; i < keys.length; i += 1) {
            var key = keys[i]
            if (o.keydowns[key]) {
              o.actions[key]()
            }
          }
          o.update()
          // clear canvas
          o.context.clearRect(0, 0, canvas.width, canvas.height)
          // draw image
          o.draw()
        }, 1000 / o.fps)

        return o
      }

      var game = Game()
      var paddle = Paddle()
      var ball = Ball()
      var secondBall = Ball(300, 500)

      game.registerAction('a', paddle.moveLeft)
      game.registerAction('d', paddle.moveRight)
      game.registerAction('f', function () {
        ball.fire()
        secondBall.fire()
      })
      game.update = function () {
        ball.move()
        secondBall.move()
        if (paddle.collide(ball)) {
          ball.speedY *= -1
        }
        if (paddle.collide(secondBall)) {
          secondBall.speedY *= -1
        }

      }
      game.draw = function () {
        game.drawImage(paddle)
        game.drawImage(ball)
        game.drawImage(secondBall)
      }

      // // var paddle = n
      // window.addEventListener('load', function () {
      //   log(paddle)
      //   context.drawImage(paddle.image, paddle.x, paddle.y)
      // }, false)



      // var draw = function () {
      //   context.clearRect(0, 0, canvas.width, canvas.height)
      //   context.drawImage(paddle.image, paddle.x, paddle.y)
      // }
      // setInterval(function () {
      //   if (leftDown) {
      //     paddle.x -= paddle.speed
      //   }
      //   if (rightDown) {
      //     paddle.x += paddle.speed
      //   }
      //   draw()
      // }, 1000 / 30)

    }
    __main()
  </script>
</body>

</html>